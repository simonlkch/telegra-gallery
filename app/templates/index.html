<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Telegraph Admin Portal</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
      body {
        padding-top: 3rem;
      }
      .container {
        max-width: 960px;
      }

      /* Light mode styles */
      body.light-mode {
        background-color: #ffffff;
        color: #000000;
      }

      .navbar-light {
        background-color: #f8f9fa;
      }

      .btn-light-mode {
        background-color: #ffffff;
        color: #000000;
      }

      /* Dark mode styles */
      body.dark-mode {
        background-color: #181818;
        color: #ffffff;
      }

      .navbar-dark {
        background-color: #343a40;
      }

      .btn-dark-mode {
        background-color: #181818;
        color: #ffffff;
      }

      /* Dark mode table header */
      .dark-mode .table thead th {
        color: #ffffff;
      }
    </style>
  </head>
  <body class="dark-mode">
    <nav class="navbar navbar-expand-md navbar-dark fixed-top">
      <a class="navbar-brand" href="#">Telegraph Admin Portal</a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarCollapse">
        <ul class="navbar-nav mr-auto">
          <li class="nav-item">
            <a class="nav-link" href="{{ url_for('index') }}">Upload</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" id="createdPagesLink" href="#">Created Pages</a>
          </li>
        </ul>
        <button id="darkModeToggle" class="btn btn-dark-mode">Light Mode</button>
      </div>
    </nav>
    <main role="main" class="container">
      <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
        <h1 class="h2">Upload Images to Telegra.ph</h1>
      </div>
      <form id="uploadForm" action="/" method="post" enctype="multipart/form-data">
        <div class="form-group">
          <label for="access_token">Access Token:</label>
          <input type="text" class="form-control" id="access_token" name="access_token" required>
        </div>
        <div class="form-group">
          <label for="title">Page Title:</label>
          <input type="text" class="form-control" id="title" name="title" required>
        </div>
        <div class="form-group">
          <label for="images">Select Images:</label>
          <input type="file" class="form-control-file" id="images" name="images" multiple required>
        </div>
        <div class="progress">
          <div id="progressBar" class="progress-bar" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">0%</div>
        </div>
        <button type="submit" class="btn btn-primary">Upload</button>
      </form>
    </main>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        // Dark Mode Toggle
        document.getElementById('darkModeToggle').addEventListener('click', function() {
          var body = document.body;
          var navbar = document.querySelector('.navbar');
          var button = document.getElementById('darkModeToggle');
          if (body.classList.contains('light-mode')) {
            body.classList.remove('light-mode');
            body.classList.add('dark-mode');
            navbar.classList.remove('navbar-light');
            navbar.classList.add('navbar-dark');
            button.classList.remove('btn-light-mode');
            button.classList.add('btn-dark-mode');
            button.textContent = 'Light Mode';
          } else {
            body.classList.remove('dark-mode');
            body.classList.add('light-mode');
            navbar.classList.remove('navbar-dark');
            navbar.classList.add('navbar-light');
            button.classList.remove('btn-dark-mode');
            button.classList.add('btn-light-mode');
            button.textContent = 'Dark Mode';
          }
        });

        // Upload Form Submission with Progress Bar
        document.getElementById('uploadForm').addEventListener('submit', function(event) {
          event.preventDefault();

          var formData = new FormData(this);
          var xhr = new XMLHttpRequest();
          xhr.open('POST', '/', true);

          xhr.upload.onprogress = function(event) {
            if (event.lengthComputable) {
              var percentComplete = (event.loaded / event.total) * 100;
              var progressBar = document.getElementById('progressBar');
              progressBar.style.width = percentComplete + '%';
              progressBar.setAttribute('aria-valuenow', percentComplete);
              progressBar.innerHTML = Math.round(percentComplete) + '%';
            }
          };

          xhr.onload = function() {
            if (xhr.status === 200) {
              var accessToken = document.getElementById('access_token').value;
              localStorage.setItem('access_token', accessToken);
              document.getElementById('createdPagesLink').click();
            } else {
              alert('Upload failed');
            }
          };

          xhr.send(formData);
        });

        // Redirect to created pages
        document.getElementById('createdPagesLink').addEventListener('click', function() {
          var accessToken = localStorage.getItem('access_token');
          if (accessToken) {
            window.location.href = '/pages?access_token=' + accessToken;
          } else {
            alert('Please enter an access token first.');
          }
        });
      });
    </script>
  </body>
</html>
